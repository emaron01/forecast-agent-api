{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/maron/Documents/forecast-agent-api/web/app/debug/opportunities/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { Pool } from \"pg\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: { rejectUnauthorized: false },\r\n});\r\n\r\nfunction withCors(req: Request, res: NextResponse) {\r\n  const origin = req.headers.get(\"origin\") || \"\";\r\n  const isLocal = origin.startsWith(\"http://localhost:\") || origin.startsWith(\"http://127.0.0.1:\");\r\n\r\n  if (isLocal) res.headers.set(\"Access-Control-Allow-Origin\", origin);\r\n  res.headers.set(\"Vary\", \"Origin\");\r\n  res.headers.set(\"Access-Control-Allow-Methods\", \"GET,OPTIONS\");\r\n  res.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type\");\r\n  return res;\r\n}\r\n\r\nexport async function OPTIONS(req: Request) {\r\n  return withCors(req, new NextResponse(null, { status: 204 }));\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const url = new URL(req.url);\r\n    const orgId = Number(url.searchParams.get(\"org_id\") || \"1\") || 1;\r\n    const repName = url.searchParams.get(\"rep_name\");\r\n\r\n    let query = `\r\n      SELECT *\r\n      FROM opportunities\r\n      WHERE org_id = $1\r\n    `;\r\n    const params: any[] = [orgId];\r\n\r\n    if (repName) {\r\n      query += \" AND rep_name = $2\";\r\n      params.push(repName);\r\n    }\r\n\r\n    query += \" ORDER BY updated_at DESC\";\r\n\r\n    const result = await pool.query(query, params);\r\n    return withCors(req, NextResponse.json(result.rows));\r\n  } catch (err: any) {\r\n    console.error(\"‚ùå /debug/opportunities error:\", err?.message || err);\r\n    return withCors(\r\n      req,\r\n      NextResponse.json({ error: err?.message || String(err) }, { status: 500 })\r\n    );\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;;;;AAEO,MAAM,UAAU;AAEvB,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QAAE,oBAAoB;IAAM;AACnC;AAEA,SAAS,SAAS,GAAY,EAAE,GAAiB;IAC/C,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC5C,MAAM,UAAU,OAAO,UAAU,CAAC,wBAAwB,OAAO,UAAU,CAAC;IAE5E,IAAI,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,+BAA+B;IAC5D,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ;IACxB,IAAI,OAAO,CAAC,GAAG,CAAC,gCAAgC;IAChD,IAAI,OAAO,CAAC,GAAG,CAAC,gCAAgC;IAChD,OAAO;AACT;AAEO,eAAe,QAAQ,GAAY;IACxC,OAAO,SAAS,KAAK,IAAI,uJAAY,CAAC,MAAM;QAAE,QAAQ;IAAI;AAC5D;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,QAAQ,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,aAAa,QAAQ;QAC/D,MAAM,UAAU,IAAI,YAAY,CAAC,GAAG,CAAC;QAErC,IAAI,QAAQ,CAAC;;;;IAIb,CAAC;QACD,MAAM,SAAgB;YAAC;SAAM;QAE7B,IAAI,SAAS;YACX,SAAS;YACT,OAAO,IAAI,CAAC;QACd;QAEA,SAAS;QAET,MAAM,SAAS,MAAM,KAAK,KAAK,CAAC,OAAO;QACvC,OAAO,SAAS,KAAK,uJAAY,CAAC,IAAI,CAAC,OAAO,IAAI;IACpD,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,iCAAiC,KAAK,WAAW;QAC/D,OAAO,SACL,KACA,uJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,WAAW,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IAE5E;AACF"}}]
}